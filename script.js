// ==UserScript==
// @name         Pixelplace exploit
// @namespace    http://tampermonkey.net/
// @version      0.1
// @description  try to take over the world!
// @author       You
// @match        https://pixelplace.io/7-pixels-world-war
// @icon         https://www.google.com/s2/favicons?domain=pixelplace.io
// @grant        none
// ==/UserScript==

//Socket.io injection
(function() {
    'use strict';
    const set = function(r,i) {
        globalThis[r] = i
    }
    const get = function(r) {
        return globalThis[r]
    }
    const old = get('io')
    set('old',old)
    set('conns',[])

    function FunctionInjector(old_function,on_function_fired) {
        return function(...args) {
            const original = old_function(...args)
            on_function_fired(original,...args)
            console.warn('Beep boop')
            return original
        }
    }

    function cache_copy_io_emit(old_function,after_function) {
        var cache = old_function;
        console.log(cache)
        return function(t) {
            var old = cache(t)
            after_function(t)
            console.log(old)
            return old
        }
    }
    const normal_injector = (original, ...args) => {
        console.warn('Just fired', args)
    }
    normal_injector.new = function(event) {
        return function() {event();normal_injector()}
    }
    globalThis['io'] = function(...args) {
        let _original = old(...args)
        const _another_original = old(...args)
        _original.emit = function(t) {
            _another_original.emit.apply(this, arguments)
            console.warn(t)
            console.warn(arguments)
            _another_original.emit(t)
        }
        console.log(_original.emit.toString())
        globalThis['conns'].push(_original)
        return _original
    }
    function PutPixel(x,y, color_code) {
        conns[0].emit('p',[x, y, color_code, 1])
    }
    //PutPixel is just an exmaple. I can do so much than that but im tired
})();
